machine:
  timezone:
    Europe/Berlin

dependencies:
  cache_directories:
    - /home/ubuntu/api/redis-2.8.18
  pre:
    - source /etc/lsb-release && echo "deb http://download.rethinkdb.com/apt $DISTRIB_CODENAME main" | sudo tee /etc/apt/sources.list.d/rethinkdb.list
    - wget -qO- http://download.rethinkdb.com/apt/pubkey.gpg | sudo apt-key add -
    - sudo apt-get update
    - sudo apt-get install rethinkdb
    - if [[ ! -e redis-2.8.18/src/redis-server ]]; then wget http://download.redis.io/releases/redis-2.8.18.tar.gz && tar xvzf redis-2.8.18.tar.gz; fi
    - if [[ ! -e redis-2.8.18/src/redis-server ]]; then cd redis-2.8.18 && make; fi
    - go get github.com/apcera/gnatsd
  post:
    - rethinkdb --bind all:
        background: true
    - src/redis-server:
        background: true
    - gnatsd:
        background: true

test:
  override:
    - go test -v ./...
